<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Stündliche Wettervorhersage</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h1 {
      margin-bottom: 20px;
    }
    .header {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    select {
      font-size: 1em;
      padding: 5px;
    }
    .vorhersage {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
    }
    .stunde {
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      font-size: 0.9em;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Stündliche Wettervorhersage</h1>
    <select id="stadt" onchange="ladeVorhersage()">
      <option value="erfurt">Erfurt</option>
      <option value="szeged">Szeged</option>
    </select>
  </div>
  <div class="vorhersage" id="vorhersage">Lade...</div>

  <script>
    const codes = {
      0: 'Klarer Himmel',
      1: 'Überwiegend klar',
      2: 'Teilweise bewölkt',
      3: 'Bedeckt',
      45: 'Nebel',
      48: 'Reifnebel',
      51: 'Leichter Nieselregen',
      53: 'Mäßiger Nieselregen',
      55: 'Starker Nieselregen',
      56: 'Leichter gefrierender Nieselregen',
      57: 'Starker gefrierender Nieselregen',
      61: 'Leichter Regen',
      63: 'Mäßiger Regen',
      65: 'Starker Regen',
      66: 'Leichter gefrierender Regen',
      67: 'Starker gefrierender Regen',
      71: 'Leichter Schneefall',
      73: 'Mäßiger Schneefall',
      75: 'Starker Schneefall',
      77: 'Schneegriesel',
      80: 'Leichte Regenschauer',
      81: 'Mäßige Regenschauer',
      82: 'Heftige Regenschauer',
      85: 'Leichte Schneeschauer',
      86: 'Starke Schneeschauer',
      95: 'Gewitter',
      96: 'Gewitter mit leichtem Hagel',
      99: 'Gewitter mit starkem Hagel'
    };

    const orte = {
      erfurt: { lat: 50.98, lon: 11.03 },
      szeged: { lat: 46.25, lon: 20.15 }
    };

    async function ladeVorhersage() {
      const stadt = document.getElementById('stadt').value;
      const koordinaten = orte[stadt];
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${koordinaten.lat}&longitude=${koordinaten.lon}&hourly=temperature_2m,weathercode,windspeed_10m,precipitation_probability&timezone=auto`;
      const res = await fetch(url);
      const data = await res.json();
      const zeiten = data.hourly.time;
      const temperaturen = data.hourly.temperature_2m;
      const winde = data.hourly.windspeed_10m;
      const wettercodes = data.hourly.weathercode;
      const regenwahrscheinlichkeit = data.hourly.precipitation_probability;

      const ausgabe = document.getElementById('vorhersage');
      ausgabe.innerHTML = '';

      const jetzt = new Date();
      const aktuelleStunde = jetzt.getHours();
      const startIndex = zeiten.findIndex(t => new Date(t).getHours() === aktuelleStunde && new Date(t).getDate() === jetzt.getDate());

      for (let i = startIndex; i < startIndex + 24 && i < zeiten.length; i++) {
        const zeit = new Date(zeiten[i]);
        const uhrzeit = zeit.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const temp = temperaturen[i];
        const wind = winde[i];
        const code = wettercodes[i];
        const regen = regenwahrscheinlichkeit[i];
        const bedingung = codes[code] || 'Unbekannt';

        const block = document.createElement('div');
        block.className = 'stunde';
        block.innerText =
          `Uhrzeit: ${uhrzeit}\n` +
          `Temperatur: ${temp}°C\n` +
          `Wind: ${wind} km/h\n` +
          `Zustand: ${bedingung}\n` +
          `Regenwahrscheinlichkeit: ${regen}%`;

        ausgabe.appendChild(block);
      }
    }

    ladeVorhersage();
    setInterval(ladeVorhersage, 3600000);
  </script>
</body>
</html>
